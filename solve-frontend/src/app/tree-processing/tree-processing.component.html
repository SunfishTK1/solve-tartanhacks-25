<!DOCTYPE html>
<div class="processing-container">
  <h1>Tree Structure</h1>
  <div class="tree-container" *ngIf="!processingComplete">
    <ul class="research-tree">
      <ng-container *ngFor="let node of researchTree">
        <li class="tree-node">
          <span class="node-topic">{{ node.title }}</span>
          <ul class="subtopics" *ngIf="node.children?.length > 0">
            <ng-container *ngFor="let sub of node.children">
              <li class="subtopic-node">
                <span class="subtopic">{{ sub.topic }}</span>
                <ul class="sub-subtopics" *ngIf="sub.subtopics.length > 0">
                  <li *ngFor="let subsub of sub.subtopics">
                    <span class="sub-subtopic">{{ subsub.topic }}</span>
                  </li>
                </ul>
              </li>
            </ng-container>
          </ul>
        </li>
      </ng-container>
    </ul>
  </div>
  <h2 *ngIf="processingComplete" class="completion-text">Analysis complete</h2>
</div>

<app-topbar></app-topbar>

<div class="main-container">
  <div class="summary-section">
    <h2>Research Progress</h2>
    <p>{{ currentSummary }}</p>
  </div>

  <div class="content-container">
    <div class="graph-container">
      <ngx-graph
        [links]="graphData.links"
        [nodes]="graphData.nodes"
        [autoCenter]="true"
        [autoZoom]="true"
        [curve]="curve"
        (nodeClick)="selectedNode = $event.data">
      </ngx-graph>
    </div>

    <div class="sidebar">
      <mat-accordion>
        <!-- Full Report Panel -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Full Report</mat-panel-title>
          </mat-expansion-panel-header>
          <p>{{ researchTree[0]?.full_report }}</p>
        </mat-expansion-panel>

        <!-- Subquestions Panels -->
        <mat-expansion-panel *ngFor="let subq of researchTree[0]?.subquestions">
          <mat-expansion-panel-header>
            <mat-panel-title>{{ subq.question }}</mat-panel-title>
          </mat-expansion-panel-header>
          <p>{{ subq.result }}</p>
          <div class="metrics">
            <p>Depth: {{ subq.depth }}</p>
          </div>
          <div *ngIf="subq.other_questions.length > 0">
            <h4>Related Questions:</h4>
            <ul>
              <li *ngFor="let otherQ of subq.other_questions">{{ otherQ }}</li>
            </ul>
          </div>
        </mat-expansion-panel>
      </mat-accordion>
    </div>
  </div>
</div> 